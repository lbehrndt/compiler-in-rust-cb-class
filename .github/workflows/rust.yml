name: Run Tests

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: Set up a Rust toolchain
        uses: hecrj/setup-rust-action@v2.0.1
        with:
          rust-version: ${{ matrix.rust }}

      - name: Get edited files
        id: edited_files
        run: |
          git diff-tree --no-commit-id --name-only ${{github.sha}} -r > edited_files.txt
        if: ${{ steps.edited_files.outputs.files != '' }}

      - name: Run tests for edited files
        run: |
          xargs -I {} cargo test --verbose --manifest-path={}
        shell: bash
        env:
          FILE_PATHS: ${{ steps.read_files.outputs.stdout }}
